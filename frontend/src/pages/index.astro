---

import Layout from '../layouts/Layout.astro';
import DashboardCharts from '../components/DashboardCharts.jsx';
import CategorizeButton from '../components/CategorizeButton.jsx';
import KPISection from '../components/KPISection.jsx';
import { fetchData } from '../utils/api.js';

// --- Categorías disponibles (de backend) ---
const categoriasDisponibles = [
  'todas',
  'tecnología',
  'muebles',
  'ropa',
  'electrodomésticos',
  'hogar',
  'deporte',
  'juguetes',
  'belleza',
  'herramientas',
  'otros'
];

// Preguntas notebook (puedes ajustar el texto si lo deseas)
const preguntas = {
  bar: '¿Cuál es el precio promedio de los productos por término de búsqueda?',
  line: '¿Cómo evoluciona el precio promedio por página para cada término?',
  pieFull: '¿Qué proporción de productos tienen envío Full?',
  pieFeatures: '¿Qué características principales tienen los productos ofertados?',
  pieProblems: '¿Cuáles son los principales problemas reportados en reseñas negativas?',
  piePriceRange: '¿Cómo se distribuyen los productos por rango de precio?',
  scatter: '¿Existe relación entre el precio y la calificación promedio?'
};



interface Producto {
  price?: string | number;
  search_term?: string;
  page?: number;
  full_description?: string;
  shipping?: string;
  promotion?: string;
  reviews?: { rating?: string | number; content?: string }[];
  avg_rating?: string | number;
  title?: string;
  categoria?: string;
}

---

<Layout title="Dashboard | MercadoLibre Analysis">
  <section class="mb-10">
    <h1 class="text-4xl font-extrabold mb-2 text-pastel-strong">Dashboard de Análisis</h1>
    <p class="text-lg text-pastel-text mb-6">Visualiza y explora los datos de MercadoLibre de forma clara y atractiva.</p>
    <div class="flex flex-col gap-4 mb-4">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
        <div class="flex-1">
        <KPISection client:load categoriasDisponibles={categoriasDisponibles} /> 
        </div>
          <CategorizeButton client:load apiUrl={import.meta.env.PUBLIC_API_URL || 'http://localhost:8000'} />
      </div>
    </div>
  </section>

  <section>
    <DashboardCharts
      client:only="react"
      categoriasDisponibles={categoriasDisponibles}
      preguntas={preguntas}
    />
  </section>
</Layout>